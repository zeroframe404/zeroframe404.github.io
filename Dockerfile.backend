FROM node:20-bookworm-slim

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci

COPY server ./server

RUN npm run prisma:generate
RUN npm run build:server

EXPOSE 8787

CMD ["sh", "-c", "npx prisma db push --schema server/prisma/schema.prisma && npm run start:server"]
